<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PowerStake DApp</title>
    <script src="https://cdn.jsdelivr.net/npm/ethers@5.6.8/dist/ethers.umd.min.js"></script>
</head>
<body>
    <h1>PowerStake - DApp</h1>
    <div>
        <h2>Stake PLP</h2>
        <label for="amount">Cantidad de PLP:</label>
        <input type="number" id="amount" placeholder="Cantidad de PLP">
        <label for="period">Periodo (en días):</label>
        <input type="number" id="period" placeholder="Periodo en días">
        <button onclick="stake()">Realizar Stake</button>
    </div>

    <hr>

    <div>
        <h2>Stakes Activos</h2>
        <button onclick="getActiveStakes()">Ver Stakes Activos</button>
        <ul id="stakeList"></ul>
    </div>

    <hr>

    <div>
        <h2>Deshacer Stake</h2>
        <label for="unstakeIndex">Índice del Stake a retirar:</label>
        <input type="number" id="unstakeIndex" placeholder="Índice del stake">
        <button onclick="unstake()">Retirar Stake</button>
    </div>

    <script>
        // Configurar Web3.js o Ethers.js
        const provider = new ethers.providers.Web3Provider(window.ethereum);
        let signer;
        let contract;

        const powerStakeAddress = "0xYourContractAddress"; // Dirección del contrato PowerStake
        const plpTokenAddress = "0xe5c56E4a8F8d96e3A91b18D83b7f0c36663C9a74"; // Dirección PLP
        const pwrTokenAddress = "0x3Eb3B7b3D95Cb3699295D7868F85e43b56AeeFcB"; // Dirección PWR

        const abi = [
            // Agrega el ABI de tu contrato aquí
            "function stake(uint256 amount, uint256 period) external",
            "function unstake(uint256 stakeIndex) external",
            "function getActiveStakes(address user) external view returns (tuple(uint256 amount, uint256 startTime, uint256 endTime, uint256 rewardDebt, bool withdrawn)[])",
            "function getStakeCountdown(address user, uint256 stakeIndex) external view returns (uint256)"
        ];

        // Inicializar el contrato
        async function init() {
            await provider.send("eth_requestAccounts", []); // Solicitar acceso a la cuenta de MetaMask
            signer = provider.getSigner();
            contract = new ethers.Contract(powerStakeAddress, abi, signer);
        }

        // Realizar Stake
        async function stake() {
            const amount = document.getElementById("amount").value;
            const period = document.getElementById("period").value * 86400; // Convertir días a segundos

            if (!amount || !period) {
                alert("Por favor ingresa una cantidad y un periodo.");
                return;
            }

            const tx = await contract.stake(ethers.utils.parseUnits(amount, 18), period);
            await tx.wait();
            alert("Stake realizado con éxito.");
        }

        // Ver Stakes Activos
        async function getActiveStakes() {
            const address = await signer.getAddress();
            const stakes = await contract.getActiveStakes(address);

            const stakeList = document.getElementById("stakeList");
            stakeList.innerHTML = ''; // Limpiar lista

            stakes.forEach((stake, index) => {
                const li = document.createElement("li");
                li.textContent = `Stake #${index + 1}: ${ethers.utils.formatUnits(stake.amount, 18)} PLP, Tiempo restante: ${stake.endTime - Math.floor(Date.now() / 1000)} segundos`;
                stakeList.appendChild(li);
            });
        }

        // Deshacer Stake
        async function unstake() {
            const index = document.getElementById("unstakeIndex").value;

            if (!index) {
                alert("Por favor ingresa un índice de stake.");
                return;
            }

            const tx = await contract.unstake(index);
            await tx.wait();
            alert("Stake retirado con éxito.");
        }

        // Inicializar la DApp
        init();
    </script>
</body>
</html>

